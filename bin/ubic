#!/usr/bin/perl
# Copyright (c) 2009 Yandex.ru

use strict;
use warnings;

=head1 NAME

ubic - simple viewer of ubic services

=head1 SYNOPSIS

    ubic status
    ubic start SERVICE
    ubic stop SERVICE
    ubic restart SERVICE

=cut

use Getopt::Long 2.33;
use Pod::Usage;

use Ubic;
use Ubic::Cmd;

GetOptions() or pod2usage(2);

my $command = $ARGV[0] or pod2usage(2);

if (($command eq 'status' or $command eq 'cached-status') and @ARGV == 1) {
    my $cached;
    if ($command eq 'status' and $>) {
        print "Not a root, printing cached statuses\n";
        $cached = 1;
    }
    if ($command eq 'cached-status') {
        $cached = 1;
    }
    for my $service (Ubic->services) {
        Ubic::Cmd->print_status($service->name, $cached);
    }
}
elsif (@ARGV == 2) {
    Ubic::Cmd->run({
        name => $ARGV[1],
        command => $command,
    });
}
else {
    pod2usage(2);
}

=head1 AUTHOR

Vyacheslav Matjukhin <mmcleric@yandex-team.ru>

=cut
